<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BABYMONSTER Album Pre-order</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/product-page.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="nav-left">
          <a href="/">HOME</a>
          <a href="#">ARTISTS</a>
          <a href="#">SHOP</a>
          <a href="#">SUPPORT</a>
      </div>
      <div class="nav-center">
          <img class= "logo" src="/resources/logo.jpg" alt="Logo" class="logo">
      </div>
      <div class="search-container">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input type="text" placeholder="Search for...">
          <% if (user) { %>
            <div class="dropdown">
                <a href="#">
                    <img class="profile-user" src="/resources/profile.jpg" alt="Profile">
                </a>
                <div class="dropdown-menu">
                    <a style="font-weight: bold;" href="/account">Account</a>
                    <a style="font-weight: bold;" href="/api/auth/logout">Logout</a>
                </div>
            </div>
            <a href="/cart">
                <button class="cart-button">
                    <i class="fa-solid fa-cart-shopping" style="color: #fbfbf5;"></i> Cart
                </button>
            </a>
        <% } else { %>   
            <a href="/login-page">
                <img class="profile-user" src="/resources/profile.jpg" alt="Profile">
            </a>
            <a class ="hidden" href="/cart">
                <button class="cart-button">
                    <i class="fa-solid fa-cart-shopping" style="color: #fbfbf5;"></i> Cart
                </button>
            </a>
        <% } %>
      </div>
  </nav>

  
<div class="main-content">
    <div class="product-images">
        <img src="<%= product.imageH %>" alt="Main Product Image" class="main-image" id="mainImage">
        <div class="thumbnail-container">
            <!-- Initial header thumbnail -->
            <img src="<%= product.imageH %>" alt="Header Thumbnail" class="thumbnail">
            
            <!-- All version images as thumbnails -->
            <% product.versions.forEach(version => { %>
                <% version.image.forEach((img, imgIndex) => { %>
                    <img src="<%= img %>" 
                         alt="<%= version.version %> Image <%= imgIndex + 1 %>" 
                         class="thumbnail">
                <% }); %>
            <% }); %>
        </div>
    </div>
    <div class="product-info">
        <p class="product-artist"><%= product.artist %></p>
        <h1 class="product-title"><%= product.name %></h1>
        <p class="product-price">$<%= product.price.toFixed(2) %></p>
        
        <label for="versionSelect">Choose Version:</label>
        <select id="versionSelect" class="version-select">
            <% product.versions.forEach((version, index) => { %>
                <option value="<%= index %>"><%= version.version %></option>
            <% }) %>
        </select>
        <div class="expandable-section">
          <div class="expandable-header">
            <span>Product Information</span>
            <span class="expand-icon">+</span>
          </div>
          <div class="expandable-content">
            <ul class="product-description-list">
              <% product.description.forEach(item => { %>
                <li><%= item %></li>
              <% }) %>
            </ul>
          </div>
        </div>
        
        <div class="expandable-section">
            <div class="expandable-header">
                <span>Inclusions</span>
                <span class="expand-icon">+</span>
            </div>
            <div class="expandable-content">
                <ul class="product-inclusions-list">
                    <% product.inclusions.forEach(inclusion => { %>
                        <li><%= inclusion %></li>
                    <% }) %>
                </ul>
            </div>
        </div>
        <p class="stock-info" id="stockInfo"><%= product.totalQuantity %> items left in stock</p>
        <button class="add-to-cart-btn" data-product-id="<%= product._id %>">Add to Cart</button>
    </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const mainImage = document.getElementById('mainImage');
      const stockInfo = document.getElementById('stockInfo');
      const versionSelect = document.getElementById('versionSelect');
      const product = <%- JSON.stringify(product) %>; 

      // Calculate default stock quantity by summing up all version quantities
      const calculateTotalStock = () => {
          return product.versions.reduce((total, version) => total + version.quantity, 0);
      };

      // Set initial stock information to the total quantity
      stockInfo.textContent = `${calculateTotalStock()} items left in stock`;

      // Update displayed information based on selected version
      versionSelect.addEventListener('change', (event) => {
          const selectedIndex = event.target.value;
          const selectedVersion = product.versions[selectedIndex];
  
          // Update main image
          mainImage.src = selectedVersion.image[0];
  
          // Update stock quantity or display "OUT OF STOCK"
          if (selectedVersion.quantity > 0) {
              stockInfo.textContent = `${selectedVersion.quantity} items left in stock`;
              stockInfo.classList.remove('out-of-stock');
          } else {
              stockInfo.textContent = "OUT OF STOCK";
              stockInfo.classList.add('out-of-stock');
          }
      });
  
      // Expandable sections for product information and inclusions
      document.querySelectorAll('.expandable-header').forEach(header => {
          header.addEventListener('click', () => {
              const content = header.nextElementSibling;
              const icon = header.querySelector('.expand-icon');
              if (content.style.display === 'block') {
                  content.style.display = 'none';
                  icon.textContent = '+';
              } else {
                  content.style.display = 'block';
                  icon.textContent = '-';
              }
          });
      });
  
      // Thumbnail gallery to change the main image
      document.querySelectorAll('.thumbnail').forEach(thumb => {
          thumb.addEventListener('click', () => {
              mainImage.src = thumb.src;
          });
      });
  });
</script>
    <script id="productData" type="application/json">
    <%- JSON.stringify(product) %>
    </script>
    <script src="/public/scripts/Cart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/public/scripts/Footer.js"></script>
    <script src="/public/scripts/Product-Page.js"></script>
</body>
</html>
