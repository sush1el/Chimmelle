<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Account Page</title>
    <link rel="stylesheet" href="styles/account.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <a href="/">HOME</a>
            <a href="#">ARTISTS</a>
            <a href="#">SHOP</a>
            <a href="#">SUPPORT</a>
        </div>
        <img src="resources/logo.jpg" alt="Logo" class="logo">
        <div class="nav-right">
            <div class="search-container">
                <i class="search-icon fas fa-search"></i>
                <input type="text" placeholder="Search for ...">
            </div>
            <img src="resources/profile.jpg" alt="Profile" class="profile-user">
            <a href="/cart" class="cart-link">
                <button class="cart-button">
                    <i class="fa-solid fa-cart-shopping"></i> Cart
                </button>
            </a>
        </div>
    </nav>

    <div class="container">
        <h1 class="welcome">Welcome, <%= user.firstName %> <%= user.lastName %>!</h1>
        <div id="account-view" class="account-grid">
            <div class="account-details-section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Account Details</h2>
                    </div>
                    <div class="card-content">
                        <p> <b>Name:</b> <%= user.firstName %> <%= user.lastName %></p>
                        <p><b>Email:</b> <%= user.email %></p>
                        <a href="#" class="btn" onclick="showAddresses()">View Addresses (<%= user.addresses.length %>)</a>
                    </div>
                </div>

                <% if (user.defaultAddress) { %>
                    <% const defaultAddress = user.addresses.find(addr => addr._id.toString() === user.defaultAddress.toString()); %>
                    <% if (defaultAddress) { %>
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Default Address</h2>
                            </div>
                            <div class="card-content">
                                <p><%= defaultAddress.street %></p>
                                <p><%= defaultAddress.region.name %></p>
                                <p><%= defaultAddress.province.name %></p>
                                <p><%= defaultAddress.city.name %></p>
                                <p><%= defaultAddress.barangay.name %></p>
                                <p><%= defaultAddress.zipCode %></p>
                                <p><%= defaultAddress.phone %></p>
                            </div>
                        </div>
                    <% } %>
                <% } else { %>
                    <p>No default address set</p>
                <% } %>

                <a href="/api/auth/logout" class="logout-btn">Logout</a>
            </div>

            <div class="order-history-section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Order History</h2>
                    </div>
                    <div class="card-content">
                        <p>You haven't placed any orders yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Addresses View -->
        <div id="addresses-view" class="hidden">
            <div class="addresses-header">
                <h4>Addresses</h4>
                <button class="btn btn-outline" onclick="showAccount()">Return to Account</button>
            </div>
            <button class="btn-add" onclick="showAddNewAddress()">Add a new Address</button>
            <div class="address-grid">
                <% user.addresses.forEach((address, index) => { %>
                    <div class="address-card" 
                         data-index="<%= index %>"
                         data-region="<%= JSON.stringify(address.region) %>"
                         data-province="<%= JSON.stringify(address.province) %>"
                         data-city="<%= JSON.stringify(address.city) %>"
                         data-barangay="<%= JSON.stringify(address.barangay) %>">
                        <p data-field="street">Street: <%= address.street %></p>
                        <p data-field="region">Region: <%= address.region.name %></p>
                        <p data-field="province">Province: <%= address.province.name %></p>
                        <p data-field="city">City/Municipality: <%= address.city.name %></p>
                        <p data-field="barangay">Barangay: <%= address.barangay.name %></p>
                        <p data-field="zipCode">Zip Code: <%= address.zipCode %></p>
                        <p data-field="phone">Phone: <%= address.phone %></p>
                        <div class="address-actions">
                            <button class="btn-edit" onclick="showEditAddress(<%= index %>)">Edit</button>
                            <button class="btn-delete" onclick="deleteAddress(<%= index %>)">Delete</button>
                            <button class="btn-default" onclick="setDefaultAddress(<%= index %>)">
                                <%= user.defaultAddress && user.defaultAddress.toString() === address._id.toString() ? 'Default Address' : 'Set as Default' %>
                            </button>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
    
    <style>
        .swal2-input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .swal2-input {
            margin: 0 !important;
            font-size: 18px;
        }
        
        .swal2-title {
            font-family: 'Montserrat', sans-serif;
        }
        
        /* Optional: Style the SweetAlert buttons to match your theme */
        .swal2-confirm {
            background-color: #da9e9f !important;
            color: white !important;
        }
        
        .swal2-cancel {
            background-color: #EDE9E9 !important;
            color: #da9e9f;
        }
    </style>

    <script type="module" src="scripts/Account.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>